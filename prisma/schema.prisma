generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         Int         @id @default(autoincrement())
  name       String
  email      String      @unique
  password   String
  role       String      @default("user")
    isVerified            Boolean     @default(false)
  verificationToken     String?     @unique
  verificationExpires   DateTime?
  created_at DateTime    @default(now())
  purchases  PURCHASES[]
  sales      SALE[]
  token      Token[]
}

model Token {
  id        Int      @id @default(autoincrement())
  token     String
  userId    Int @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Supplier {
  id              Int                @id @default(autoincrement())
  name            String
  phone           String @unique
  email           String             @unique
  address         String             @default("")
  created_at      DateTime           @default(now())
  medicineBatches MEDICINE_BATCHES[]
  purchases       PURCHASES[]
}

model Medicine {
  id                    Int                @id @default(autoincrement())
  name                  String
  generic_name          String
  price_sell            Decimal            @db.Decimal(10, 2)
  min_quantity          Int
  requires_prescription Boolean @default(false)
  created_at            DateTime           @default(now())
  medicineBatches       MEDICINE_BATCHES[]
  purchaseItems         PURCHASE_ITEMS[]
  saleItems             SALE_ITEMS[]
}

model MEDICINE_BATCHES {
  id            Int              @id @default(autoincrement())
  medicine_id   Int
  supplier_id   Int
  batch_number  String
  quantity      Int
  price_buy     Decimal          @db.Decimal(10, 2)
  expiry_Date   DateTime
  created_at    DateTime         @default(now())
  medicine      Medicine         @relation(fields: [medicine_id], references: [id])
  supplier      Supplier         @relation(fields: [supplier_id], references: [id])
  purchaseItems PURCHASE_ITEMS[]
  saleItems     SALE_ITEMS[]
}

model PURCHASES {
  id            Int              @id @default(autoincrement())
  user_id       Int
  supplier_id   Int
  total_amount  Decimal          @db.Decimal(10, 2)
  purchase_date DateTime         @default(now())
  supplier      Supplier         @relation(fields: [supplier_id], references: [id])
  user          User             @relation(fields: [user_id], references: [id])
  purchaseItems PURCHASE_ITEMS[]
}

model PURCHASE_ITEMS {
  id          Int              @id @default(autoincrement())
  purchase_id Int
  medicine_id Int
  batch_id    Int
  quantity    Int
  unit_price  Decimal          @db.Decimal(10, 2)
  subtotal    Decimal          @db.Decimal(10, 2)
  batch       MEDICINE_BATCHES @relation(fields: [batch_id], references: [id])
  medicine    Medicine         @relation(fields: [medicine_id], references: [id])
  purchase    PURCHASES        @relation(fields: [purchase_id], references: [id])
}

model SALE {
  id             Int          @id @default(autoincrement())
  user_id        Int
  total_amount   Decimal      @db.Decimal(10, 2)
  payment_method String       @default("cash")
  created_at     DateTime     @default(now())
  user           User         @relation(fields: [user_id], references: [id])
  saleItems      SALE_ITEMS[]
}

model SALE_ITEMS {
  id          Int              @id @default(autoincrement())
  sale_id     Int
  medicine_id Int
  batch_id    Int
  quantity    Int
  unit_price  Decimal          @db.Decimal(10, 2)
  subtotal    Decimal          @db.Decimal(10, 2)
  batch       MEDICINE_BATCHES @relation(fields: [batch_id], references: [id])
  medicine    Medicine         @relation(fields: [medicine_id], references: [id])
  sale        SALE             @relation(fields: [sale_id], references: [id])
}
